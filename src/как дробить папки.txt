тут описаны мои мысли по развитию проекта.
разбить корневую папку на много папок заданого размера, так чтобы подпапки не дробились,
 но если драбление происходила оставалось минимум свободного места на диске

сортировать папки по медианному файлу
расчитать примерно сколько папок будет, поделить попалам.
записать полностью папку?
если папка большая подробить?

подробить основную папку с минимальным дроблением листов.